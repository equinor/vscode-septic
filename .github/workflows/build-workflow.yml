name: "ðŸ› ï¸ Build Artifact"
on:
  workflow_call:
    outputs:
      artifact-name:
        value: ${{ jobs.build.outputs.artifact-name }}

jobs:
  build:
    name: "ðŸ› ï¸ Build Extension"
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: packages/extension
    steps:
      - uses: actions/checkout@v5
      - name: Install pnpm
        uses: pnpm/action-setup@v4
      - name: "Setup Node.js"
        uses: actions/setup-node@v6
        with:
          node-version: 20
      - name: "Install dependencies"
        run: pnpm install
      - name: "Create Artifact"
        run: npx @vscode/vsce package --no-dependencies
      - name: "Resolve build version"
        run: echo "BUILD_VERSION=$GITHUB_SHA" >> $GITHUB_ENV
      - name: "Set artifact name"
        run: echo "ARTIFACT_NAME=$(echo vscode-septic-${{ env.BUILD_VERSION }}.vsix)" >> $GITHUB_ENV
      - name: "Upload artifact"
        uses: actions/upload-artifact@v5
        with:
          name: ${{ env.ARTIFACT_NAME }}
          path: "*.vsix"
          retention-days: 7

    outputs:
      artifact-name: ${{ env.ARTIFACT_NAME }}
