name: "ðŸ› ï¸ Build Artifact"
on:
  workflow_call:
    outputs:
      artifact-name:
        value: ${{ jobs.build.outputs.artifact-name }}
    inputs:
      pre_release:
        required: false
        type: boolean
        default: false

jobs:
  build:
    name: "ðŸ› ï¸ Build"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: "Setup Node.js"
        uses: actions/setup-node@v3
        with:
          node-version: 16

      - name: "Install dependencies"
        run: npm ci

      - name: "Create Artifact"
        run: npx vsce package  ${{ inputs.pre_release && '--pre-release' || ''}}

      - name: "Resolve build version"
        run: echo "BUILD_VERSION=$GITHUB_SHA" >> $GITHUB_ENV

      - name: "Set artifact name"
        run: echo "ARTIFACT_NAME=$(echo vscode-septic-${{ env.BUILD_VERSION }}.vsix)" >> $GITHUB_ENV

      - name: "Upload artifact"
        uses: actions/upload-artifact@v3
        with:
          name: ${{ env.ARTIFACT_NAME }}
          path: "*.vsix"
          retention-days: 7

    outputs:
      artifact-name: ${{ env.ARTIFACT_NAME }}
