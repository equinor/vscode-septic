name: ðŸŽ‰ Release Please
on:
  push:
    branches:
      - main
permissions:
  contents: write
  pull-requests: write

jobs:
  release_please:
    name: ðŸ”– Release Please
    runs-on: ubuntu-latest
    outputs:
      extension_release_created: ${{ steps.release.outputs['packages/extension--release_created'] }}
      lib_release_created: ${{ steps.release.outputs['packages/septic--release_created'] }}
    steps:
      - name: Create Release
        id: release
        uses: googleapis/release-please-action@v4
        with:
          config-file: .github/release-please-config.json
          manifest-file: .github/.release-please-manifest.json
      - name: Print release outputs for debugging
        continue-on-error: true
        run: |
          echo "Release outputs:"
          echo '${{ toJSON(steps.release.outputs) }}' | jq '.' || echo '${{ toJSON(steps.release.outputs) }}'
  publish_extension:
    name: "Publish Extension"
    if: ${{ needs.release_please.outputs.extension_release_created }}
    needs: [release_please]
    uses: ./.github/workflows/publish-extension.yml
  publish_lib:
    name: "Publish Lib"
    if: ${{ needs.release_please.outputs.lib_release_created }}
    needs: [release_please]
    uses: ./.github/workflows/publish-lib.yml
    permissions:
      id-token: write
      contents: read
